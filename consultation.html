<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            padding: 8px;
            background: linear-gradient(145deg, var(--tg-theme-bg-color, #f6f6f6) 0%, var(--tg-theme-secondary-bg-color, #e0e0e0) 100%);
            color: var(--tg-theme-text-color, #000);
            min-height: 100vh;
            margin: 0;
            overflow-x: hidden;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .container {
            max-width: 450px;
            margin: 0 auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(5px);
        }
        .header {
            text-align: center;
            margin-bottom: 5px;
            animation: slideIn 0.8s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateY(-20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .header h1 {
            font-size: 18px;
            margin: 3px 0;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--tg-theme-text-color, #000);
        }
        .info-text {
            text-align: center;
            margin-bottom: 15px;
            font-size: 14px;
            line-height: 1.4;
            color: var(--tg-theme-text-color, #000);
            animation: fadeInUp 0.8s ease-out;
        }
        .form-container {
            display: flex;
            flex-direction: column;
            margin-bottom: 10px;
        }
        .form-group {
            margin-bottom: 10px;
            animation: fadeInUp 0.8s ease-out forwards;
            opacity: 0;
        }
        .form-group:nth-child(1) { animation-delay: 0.1s; }
        .form-group:nth-child(2) { animation-delay: 0.2s; }
        .form-group:nth-child(3) { animation-delay: 0.3s; }
        
        @keyframes fadeInUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        .form-label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            font-size: 14px;
            color: var(--tg-theme-text-color, #000);
        }
        .form-input {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            font-size: 14px;
            background-color: rgba(255, 255, 255, 0.8);
            color: var(--tg-theme-text-color, #000);
            box-sizing: border-box;
        }
        .form-textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            font-size: 14px;
            background-color: rgba(255, 255, 255, 0.8);
            color: var(--tg-theme-text-color, #000);
            box-sizing: border-box;
            min-height: 80px;
            resize: vertical;
        }
        .button-container {
            margin-top: 5px;
            flex: 0 0 auto;
        }
        .button {
            padding: 10px 15px;
            border: none;
            border-radius: 10px;
            background-color: var(--tg-theme-button-color, #3390ec);
            color: var(--tg-theme-button-text-color, #ffffff);
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            width: 100%;
            margin-top: 8px;
            position: relative;
            overflow: hidden;
            animation: slideInLeft 0.6s ease-out forwards;
            opacity: 0;
        }
        .button::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(30deg);
            transition: transform 0.5s;
            pointer-events: none;
        }
        .button:hover::after {
            transform: rotate(30deg) translate(50%, 50%);
        }
        .button:hover {
            transform: scale(1.02);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
        }
        .button:active {
            transform: scale(0.98);
            opacity: 0.8;
        }
        .back-button {
            background-color: transparent;
            color: var(--tg-theme-button-color, #3390ec);
            border: 1px solid var(--tg-theme-button-color, #3390ec);
            margin-top: 5px;
            animation: slideInRight 0.6s ease-out forwards;
            animation-delay: 0.1s;
        }
        @keyframes slideInLeft {
            from { transform: translateX(-50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        @keyframes slideInRight {
            from { transform: translateX(50px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        .contact-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
        }
        
        .contact-button {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            border-radius: 10px;
            background-color: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            width: 30%;
        }
        
        .contact-button.active {
            background-color: rgba(var(--tg-theme-button-color-rgb, 51, 144, 236), 0.2);
            border-color: var(--tg-theme-button-color, #3390ec);
        }
        
        .contact-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
        }
        
        .contact-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .contact-icon img {
            width: 24px;
            height: 24px;
        }
        
        .contact-label {
            font-size: 12px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å</h1>
        </div>
        
        <div class="info-text">
            –û—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à–∏ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –º—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ —Å–≤—è–∂–µ–º—Å—è —Å –í–∞–º–∏
        </div>
        
        <div class="form-container">
            <div class="form-group">
                <label class="form-label" for="name">–í–∞—à–µ –∏–º—è</label>
                <input type="text" id="name" class="form-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è">
            </div>
            
            <div class="form-group">
                <label class="form-label">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏</label>
                <div class="contact-buttons">
                    <div class="contact-button" onclick="selectContact('whatsapp')" id="whatsapp-button">
                        <div class="contact-icon"><img src="logo/whatsap.svg" alt="WhatsApp"></div>
                        <div class="contact-label">WhatsApp</div>
                    </div>
                    <div class="contact-button" onclick="selectContact('telegram')" id="telegram-button">
                        <div class="contact-icon"><img src="logo/tg.svg" alt="Telegram"></div>
                        <div class="contact-label">Telegram</div>
                    </div>
                    <div class="contact-button" onclick="selectContact('email')" id="email-button">
                        <div class="contact-icon">‚úâÔ∏è</div>
                        <div class="contact-label">Email</div>
                    </div>
                </div>
                <input type="text" id="contact" class="form-input" style="margin-top: 10px;" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é">
            </div>
            
            <div class="form-group">
                <label class="form-label" for="message">–í–∞—à –≤–æ–ø—Ä–æ—Å</label>
                <textarea id="message" class="form-textarea" placeholder="–û–ø–∏—à–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –∑–∞–ø—Ä–æ—Å"></textarea>
            </div>
        </div>
        
        <div class="button-container">
            <button class="button" onclick="submitForm()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            <button class="button back-button" onclick="goBack()">–ù–∞–∑–∞–¥</button>
        </div>
    </div>

    <script>
        let tg = window.Telegram.WebApp;
        tg.expand();
        
        let selectedContactType = '';
        let serviceType = '';
        
        // –ü–æ–ª—É—á–∞–µ–º —Ç–∏–ø —É—Å–ª—É–≥–∏ –∏–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
        function getServiceFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('service') || '';
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        window.onload = function() {
            serviceType = getServiceFromUrl();
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–ø–æ—Ç–µ–∫–∏ –≤ localStorage, –ø–æ–ª—É—á–∞–µ–º –∏—Ö
            if (serviceType === 'mortgage') {
                const mortgageData = JSON.parse(localStorage.getItem('mortgage_data') || '{}');
                console.log('Mortgage data:', mortgageData);
            }
        };
        
        function selectContact(type) {
            selectedContactType = type;
            
            // –£–¥–∞–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å–æ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫
            document.querySelectorAll('.contact-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∫–Ω–æ–ø–∫–µ
            document.getElementById(type + '-button').classList.add('active');
            
            // –ú–µ–Ω—è–µ–º –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞
            const contactInput = document.getElementById('contact');
            if (type === 'whatsapp') {
                contactInput.placeholder = '–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä WhatsApp';
            } else if (type === 'telegram') {
                contactInput.placeholder = '–í–≤–µ–¥–∏—Ç–µ –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è Telegram';
            } else if (type === 'email') {
                contactInput.placeholder = '–í–≤–µ–¥–∏—Ç–µ email';
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ Telegram –±–æ—Ç–∞
        async function sendToTelegramBot(data) {
            const BOT_TOKEN = '7671516191:AAE_MnEADtr6MY7wRqIvu8DHdGaL9bJAlbk';
            const ADMIN_ID = '1621625897';
            
            // –§–æ—Ä–º–∏—Ä—É–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
            let messageText = `üîî *–ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞*\n\n`;
            messageText += `*–£—Å–ª—É–≥–∞:* ${getServiceName(data.service)}\n`;
            messageText += `*–ò–º—è:* ${data.name}\n`;
            messageText += `*–°–ø–æ—Å–æ–± —Å–≤—è–∑–∏:* ${getContactTypeName(data.contactType)}\n`;
            messageText += `*–ö–æ–Ω—Ç–∞–∫—Ç:* ${data.contact}\n`;
            
            if (data.message) {
                messageText += `*–°–æ–æ–±—â–µ–Ω–∏–µ:* ${data.message}\n`;
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∏–ø–æ—Ç–µ–∫–∏, –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
            if (data.service === 'mortgage' && data.budget) {
                messageText += `\n*–î–∞–Ω–Ω—ã–µ –ø–æ –∏–ø–æ—Ç–µ–∫–µ:*\n`;
                messageText += `–ë—é–¥–∂–µ—Ç: ${new Intl.NumberFormat('ru-RU').format(data.budget)} $\n`;
                messageText += `–°—Ç–æ–∏–º–æ—Å—Ç—å –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏: ${new Intl.NumberFormat('ru-RU').format(data.propertyCost)} $\n`;
                messageText += `–í–æ–∑—Ä–∞—Å—Ç: ${data.age} –ª–µ—Ç\n`;
            }
            
            messageText += `\nüìÖ –î–∞—Ç–∞: ${new Date().toLocaleString('ru-RU')}`;
            
            try {
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ API Telegram
                const response = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: ADMIN_ID,
                        text: messageText,
                        parse_mode: 'Markdown'
                    })
                });
                
                const result = await response.json();
                console.log('Message sent to Telegram:', result);
                return result.ok;
            } catch (error) {
                console.error('Error sending message to Telegram:', error);
                return false;
            }
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —É—Å–ª—É–≥–∏ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è
        function getServiceName(serviceCode) {
            const services = {
                'mortgage': '–ò–ø–æ—Ç–µ–∫–∞',
                'visa': '–í–∏–∑–∞',
                'bank': '–°—á–µ—Ç –≤ –±–∞–Ω–∫–µ',
                'lawyer': '–Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–µ —É—Å–ª—É–≥–∏',
                'company': '–û—Ç–∫—Ä—ã—Ç–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏',
                'consultation': '–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è'
            };
            return services[serviceCode] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è —É—Å–ª—É–≥–∞';
        }
        
        // –ü–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–∏–ø–∞ –∫–æ–Ω—Ç–∞–∫—Ç–∞ –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è
        function getContactTypeName(contactType) {
            const types = {
                'whatsapp': 'WhatsApp',
                'telegram': 'Telegram',
                'email': 'Email'
            };
            return types[contactType] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π —Ç–∏–ø';
        }
        
        async function submitForm() {
            const name = document.getElementById('name').value;
            const contact = document.getElementById('contact').value;
            const message = document.getElementById('message').value;
            
            if (!name || !contact) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –∏–º—è –∏ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é');
                return;
            }
            
            if (!selectedContactType) {
                alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ —Å–ø–æ—Å–æ–± —Å–≤—è–∑–∏');
                return;
            }
            
            // –ü–æ–¥–≥–æ—Ç–∞–≤–ª–∏–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏
            const data = {
                service: serviceType || 'consultation',
                name: name,
                contactType: selectedContactType,
                contact: contact,
                message: message,
                timestamp: Date.now()
            };
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–ø–æ—Ç–µ–∫–∏, –¥–æ–±–∞–≤–ª—è–µ–º –∏—Ö
            if (serviceType === 'mortgage') {
                const mortgageData = JSON.parse(localStorage.getItem('mortgage_data') || '{}');
                Object.assign(data, mortgageData);
                
                // –û—á–∏—â–∞–µ–º localStorage
                localStorage.removeItem('mortgage_data');
            }
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ Telegram –±–æ—Ç–∞
            const sentToBot = await sendToTelegramBot(data);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –≤ Telegram WebApp
            tg.sendData(JSON.stringify(data));
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–µ
            if (sentToBot) {
                alert('–í–∞—à–∞ –∑–∞—è–≤–∫–∞ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞! –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.');
            }
            
            tg.close();
        }
        
        function goBack() {
            window.history.back();
        }
    </script>
</body>
</html> 